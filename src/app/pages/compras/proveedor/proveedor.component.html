<div class="row">
  <div class="col-12">
    <div class="card shadow">
      <div class="card-body">
        <div class="row">
          <div class="col-12 mt-2 mt-md-0 col-md-6">
            <a
              class="btn btn-primary"
              href="javascript:void(0)"
              role="button"
              routerLink="crear"
            >
              <i class="fas fa-plus-circle"></i> Crear
            </a>
          </div>
          <div class="col-12 mt-2 mt-md-0 col-md-6">
            <codice-buscador
              (termino)="termino = $event"
              (escucharCarga)="estaCargandoBuscador = $event"
            >
            </codice-buscador>
            <span
              *ngFor="let tag of etiquetasParaFiltrarse"
              [codice-tag]="tag"
              [codice-tag-click]="etiquetaEliminarDeFiltro(tag)"
              [codice-tag-click-icon-class]="[
                'fas',
                'fa-times-circle',
                'mr-1',
                'text-danger'
              ]"
            ></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!cargando; else cargaTemplate" class="row">
  <div class="col-12">
    <div class="card shadow">
      <div class="card-body table-responsive">
        <table class="table table-striped table-inverse">
          <thead class="thead-inverse">
            <tr>
              <th></th>
              <th></th>
              <th>Entidad</th>
              <th>Tipo Contacto</th>
              <th>Encargado</th>
              <th>correo</th>
              <th>Etiquetas</th>

              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contacto of contactos">
              <td>
                <a
                  (click)="detalle(contacto)"
                  class="btn btn-info ml-1"
                  href="javascript:void(0)"
                  role="button"
                >
                  <i class="fas fa-search"></i
                ></a>
              </td>
              <td>
                <a
                  (click)="editar(contacto)"
                  class="btn btn-primary"
                  href="javascript:void(0)"
                  role="button"
                >
                  <i class="fas fa-edit"></i
                ></a>
              </td>
              <td>
                <a
                  (click)="abrirModalEtiqueta(contacto)"
                  class="btn btn-outline-secondary"
                  href="javascript:void(0)"
                  role="button"
                >
                  <i class="fas fa-tag"></i
                ></a>
              </td>
              <td>{{ contacto.nombre }}</td>
              <td>
                {{ contacto.esCliente ? 'Cliente ' : '' }}
                {{ contacto.esProveedor ? 'contacto ' : '' }}
              </td>
              <td>{{ obtenerPrimerContacto(contacto)?.nombre }}</td>
              <td>{{ obtenerPrimerContacto(contacto)?.correo[0] }}</td>
              <td>
                <span
                  *ngFor="let etiqueta of contacto.etiquetas; let i = index"
                  [codice-tag]="etiqueta"
                  [codice-tag-click]="filtrarPorEtiquetas(etiqueta)"
                  [codice-tag-click-icon-class]="
                    obtenerIconoDeEtiqueta(etiqueta)
                  "
                >
                </span>
              </td>
              <td>
                <a
                  (click)="eliminar(contacto)"
                  class="btn btn-danger"
                  href="javascript:void(0)"
                  role="button"
                >
                  <i class="fas fa-times"></i
                ></a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<ng-template #cargaTemplate>
  <div class="row">
    <div class="col-12">
      <div style="width: 200px" class="text-center">
        <codice-ux-precarga></codice-ux-precarga>
      </div>
    </div>
  </div>
</ng-template>

<codice-modal [id]="idModalEtiqueta">
  <div class="row">
    <div class="col-12">
      <h1>Agregar etiqueta</h1>
    </div>
    <div *ngIf="contactoSeleccionado && !cargandoEtiquetas" class="col-12">
      <small class="text-muted">
        {{ contactoSeleccionado.nombre }}
      </small>
    </div>
    <hr />
  </div>

  <codice-etiquetas-editor
    *ngIf="contactoSeleccionado && !cargandoEtiquetas"
    [existentes]="contactoSeleccionado.etiquetas"
    (guardar)="etiquetaGuardar(contactoSeleccionado, $event)"
    (eliminar)="etiquetaEliminar(contactoSeleccionado, $event)"
  >
  </codice-etiquetas-editor>

  <div *ngIf="cargandoEtiquetas" class="col-12">
    <h1 class="display-1"><i class="fas fa-spin-fast fa-sync"></i></h1>
  </div>
</codice-modal>
